<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.mark.backend.mysql.mapper.GroupExMapper">

	<select id="queryGroupList" parameterType="java.util.Map"
		resultType="com.mark.backend.dto.GroupDto">
		SELECT
		tg.id,
		tg.group_name AS groupName,
		tg.book_name AS bookName,
		tg.group_desc AS groupDesc,
		tb.image AS groupImage
		<if test="allInfo != null">
			,tb.summary AS bookSummary,
			tb.author AS author,
			tg.begin_time AS beginDate,
			tg.end_time AS endDate,
			tg.latest_time AS
			latestDate,
			tg.read_slogan AS readSlogan,
			tg.guarantee,
			tg.frequency
		</if>
		FROM
		t_group tg,
		t_book tb
		<if test="associationId != null">
			,t_association ta,
			t_association_group tag
		</if>
		WHERE
		tg.book_id_fk = tb.id
		AND tg. STATUS != 0
		<if test="groupId != null">
			AND tg.id = ${groupId}
		</if>
		<if test="associationId != null">
			AND tag.status != 0
			AND tag.association_id_fk = ta.id
			AND
			ta.id = ${associationId}
		</if>
	</select>

	<select id="getUserGroupList" parameterType="Long"
		resultType="com.mark.backend.dto.GroupDto">
		SELECT
		tg.id,
		tg.group_name AS groupName,
		tg.group_desc AS
		groupDesc,
		tb.image AS groupImage,
		tag.association_id_fk AS
		associationId,
		tgu.user_class AS userClass,
		tgu.user_status AS
		userStatus
		FROM
		t_group tg
		LEFT JOIN t_association_group tag ON
		tag.group_id_fk = tg.id,
		t_book tb,
		t_group_user tgu
		WHERE
		tg.book_id_fk =
		tb.id
		AND tg. STATUS != 0
		AND tgu.group_id_fk = tg.id
		AND tgu.user_id_fk
		= #{userId}
	</select>
	<select id="getTotalReader" parameterType="Long" resultType="int">
		SELECT
		COUNT(*)
		FROM
		t_group_user tgu
		WHERE
		tgu.user_status != 0
		AND tgu.group_id_fk = 1
	</select>
</mapper>